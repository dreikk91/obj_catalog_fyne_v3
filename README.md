# Obj Catalog (Fyne) — Опис проекту

Опис: це графічний десктоп-застосунок на Go з UI на Fyne, призначений для перегляду та обробки подій і тривог об'єктів (АРМ — автоматизоване робоче місце). Проєкт використовує базу даних Firebird як джерело даних та модульну архітектуру для UI, логування й конфігурації.

Коротко:
- UI: Fyne (в `main.go` налаштовано вікно і панелі)
- База даних: Firebird (драйвер `github.com/nakagami/firebirdsql`)
- DB access: `github.com/jmoiron/sqlx`
- Логування: `github.com/rs/zerolog` (+ `lumberjack` для ротації)

Ключові можливості:
- Відображення списку об'єктів та їх робочої області
- Панель активних тривог та журнал подій
- Обробка тривог через діалоги (вікно обробки тривоги)
- Параметри підключення до БД та UI (збережені через Fyne Preferences)
- Фонові оновлення/симуляція подій та моніторинг здоров'я БД

Структура репозиторію (основні частини):

- `main.go` — точка входу, ініціалізація Fyne, теми, UI-компонентів, провайдера даних і циклів оновлення.
- `go.mod` — залежності, серед яких `fyne.io/fyne/v2`, `github.com/jmoiron/sqlx`, `github.com/nakagami/firebirdsql`, `github.com/rs/zerolog`.
- `pkg/config/` — конфігурація додатку (наприклад, `db_config.go`, `ui_config.go`) та функції для перетворення налаштувань у DSN.
- `pkg/database/` — ініціалізація з'єднання з Firebird (`InitDB`, `StartHealthCheck`).
- `pkg/data/` — реалізації провайдерів даних (DB provider та mock provider).
- `pkg/logger/` — налаштування логера (ротація файлів, рівні логування).
- `pkg/ui/` — реалізації панелей UI (`alarm_panel.go`, `object_list.go`, `work_area.go`, `event_log.go`, діалоги в `ui/dialogs/`).
- `pkg/models/` — доменні моделі (`alarm.go`, `event.go`, `object.go`, `zone.go`).
- `pkg/theme/` — тема застосунку (темна/світла реалізація).
- `utils/` — утиліти (наприклад, кольори, перетворення).

Конфігурація бази даних

- Конфігурація зчитується через Fyne Preferences (див. `pkg/config/db_config.go`).
- Формат DSN формується функцією `DBConfig.ToDSN()` у вигляді `user:password@host:port/path?params`.
- За замовчуванням встановлені значення (наприклад, `SYSDBA:masterkey@localhost:3050/C:/MOST.PM/BASE/MOST5.FDB`), які можна змінити в діалозі "Налаштування" у UI.

Запуск у режимі розробки

1. Встановіть Go (рекомендовано Go 1.20+; `go.mod` вказує на `go 1.24.6`).
2. Завантажте залежності та зібрати/запустити:

```powershell
go mod tidy
go run main.go
```

Пакування/реліз (Fyne)

- Для створення standalone-пакету (збірка через Fyne):

```powershell
fyne package -icon icon.png -app-id com.fyne.objcatalog -release
```

Налаштування логування

- Налаштування логера виконується через `pkg/logger`. За замовчуванням використовується `zerolog` з ротацією логів через `lumberjack`.

Робота з БД

- Ініціалізація та налаштування пулу з'єднань відбувається в `pkg/database/connect.go` (файл містить `InitDB` і `StartHealthCheck`).
- Драйвер Firebird підключено через `_ "github.com/nakagami/firebirdsql"`.
- Додаток не завмирає при відсутності БД — робиться повторна перевірка здоров'я та спроби відновлення пулу.

Розробка та внесення змін

- UI розбитий на панелі — `AlarmPanel`, `ObjectListPanel`, `WorkAreaPanel`, `EventLogPanel`. Кожна панель реалізована у `pkg/ui` і взаємодіє через інтерфейс провайдера даних (`pkg/data`).
- Щоб додати нове джерело даних — реалізуйте інтерфейс `DataProvider` у `pkg/data` і підключіть у `main.go`.

Поради для тестування

- Для локальної розробки можна реалізувати або використовувати `MockData` провайдера (існує в `pkg/data`) для симуляції подій і тривог.
- Перевіряйте оновлення панелей через виклики `Refresh()` у відповідних компонентах.

Відомі залежності

- Go: 1.24 (у `go.mod`) — переконайтесь, що у вас сумісна версія
- Fyne: v2.7.2 (UI framework)
- Firebird driver: `github.com/nakagami/firebirdsql`

Додаткові нотатки

- Тема зберігається в налаштуваннях додатка і може перемикатися кнопкою "Темна тема" у тулбарі.
- Налаштування зберігаються автоматично при першому запуску (див. `pkg/config`).

Контакти / Авторство

- Проєкт: `obj_catalog_fyne_v3`
- Якщо потрібна допомога з налаштуванням БД або пакуванням — зверніться до автора репозиторію.

License

- Ліцензія: відсутня у репо (додайте `LICENSE`, якщо потрібно)
